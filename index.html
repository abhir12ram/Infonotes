<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Q & Answers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: #f9f9f9;
      color: #111;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    header {
      background: #ffffff;
      color: #222;
      text-align: center;
      padding: 15px;
      font-size: 20px;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .container { padding: 15px; max-width: 600px; margin: auto; }

    input, textarea {
      width: 100%;
      margin: 8px 0;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 16px;
      outline: none;
      background: #fff;
      color: #111;
    }

    textarea { resize: none; height: 120px; }

    button {
      border: none;
      border-radius: 10px;
      padding: 10px 15px;
      margin: 6px 4px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.2s;
      width: 30%;
      min-width: 80px;
    }

    button:active { transform: scale(0.96); }

    button.save { background: #28a745; color: #fff; }
    button.view { background: #007bff; color: #fff; }
    button.edit { background: #ffc107; color: #111; }
    button.delete { background: #dc3545; color: #fff; }
    button.back { background: #6c757d; color: #fff; width: auto; margin-bottom: 15px; }

    .note {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      padding: 12px;
      margin-top: 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .note-title { font-weight: 600; font-size: 17px; color: #111; margin-bottom: 4px; }
    .note-extra { font-size: 14px; color: #555; margin-bottom: 5px; }
    .note-info { font-size: 12px; color: #777; margin-bottom: 6px; }
    .note-content { font-size: 14px; color: #444; white-space: pre-wrap; max-height: 70px; overflow: hidden; }

    #viewPage { display: none; padding: 15px; background: #fff; }
    #popupOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    #popupBox {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      width: 80%;
      max-width: 320px;
      text-align: center;
      box-shadow: 0 0 12px rgba(0,0,0,0.2);
    }

    #popupBox button { width: 45%; margin: 6px; }
    #popupBox .confirm { background: #dc3545; color: #fff; }
    #popupBox .cancel { background: #6c757d; color: #fff; }
  </style>
</head>

<body>

<header>üìù My Notepad</header>

<div class="container" id="homePage">
  <input type="text" id="title" placeholder="Title">
  <input type="text" id="info" placeholder="Information (optional)">
  <textarea id="content" placeholder="Write your note..."></textarea>
  <button class="save" onclick="saveNote()">Save</button>

  <div id="notesList"></div>
</div>

<div id="viewPage">
  <button class="back" onclick="goBack()">‚¨Ö Back</button>
  <h2 id="viewTitle"></h2>
  <div id="viewInfo"></div>
  <div id="viewDate"></div>
  <p id="viewContent"></p>
</div>

<div id="popupOverlay">
  <div id="popupBox">
    <p>Are you sure you want to delete this note?</p>
    <button class="confirm" onclick="confirmDelete()">Delete</button>
    <button class="cancel" onclick="closePopup()">Cancel</button>
  </div>
</div>

<script>
const API = "https://sheetdb.io/api/v1/geyyaf2q2gasg";
let deleteId = null;

document.addEventListener("DOMContentLoaded", loadNotes);

/* SAVE Note (INSERT or UPDATE) */
async function saveNote() {
  const title = titleInput.value.trim();
  const info = infoInput.value.trim();
  const content = contentInput.value.trim();

  if (!title || !content) return alert("Please enter title & content!");

  const editId = titleInput.getAttribute("data-edit-id");
  const noteData = {
    id: editId ? editId : Date.now().toString(),
    title, info, content,
    date: new Date().toLocaleString()
  };

  if (editId) {
    await fetch(`${API}/id/${editId}`, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ data: noteData })
    });
    titleInput.removeAttribute("data-edit-id");
  } else {
    await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ data: noteData })
    });
  }

  titleInput.value = "";
  infoInput.value = "";
  contentInput.value = "";

  loadNotes();
}

/* LOAD all notes */
async function loadNotes() {
  const res = await fetch(API);
  const notes = await res.json();

  notesList.innerHTML = "";

  if (notes.length === 0) {
    notesList.innerHTML = `<p style="text-align:center;color:#666;">No notes found</p>`;
    return;
  }

  notes.reverse().forEach(n => {
    const div = document.createElement("div");
    div.className = "note";

    div.innerHTML = `
      <div class="note-title">${n.title}</div>
      ${n.info ? `<div class="note-extra">‚ÑπÔ∏è ${n.info}</div>` : ""}
      <div class="note-info">üïí ${n.date}</div>
      <div class="note-content">${n.content}</div>

      <div style="margin-top:6px;">
        <button class="view" onclick="viewNote('${n.id}')">View</button>
        <button class="edit" onclick="editNote('${n.id}')">Edit</button>
        <button class="delete" onclick="openDelete('${n.id}')">Delete</button>
      </div>
    `;

    notesList.appendChild(div);
  });
}

/* VIEW Note */
async function viewNote(id) {
  const res = await fetch(`${API}/search?id=${id}`);
  const [note] = await res.json();
  if (!note) return;

  viewTitle.innerText = note.title;
  viewInfo.innerText = note.info ? "‚ÑπÔ∏è " + note.info : "";
  viewDate.innerText = "üïí " + note.date;
  viewContent.innerText = note.content;

  homePage.style.display = "none";
  viewPage.style.display = "block";
}

/* EDIT Note */
async function editNote(id) {
  const res = await fetch(`${API}/search?id=${id}`);
  const [note] = await res.json();
  if (!note) return;

  titleInput.value = note.title;
  infoInput.value = note.info;
  contentInput.value = note.content;

  titleInput.setAttribute("data-edit-id", id);
}

/* DELETE confirmation popup */
function openDelete(id) {
  deleteId = id;
  popupOverlay.style.display = "flex";
}
function closePopup() {
  deleteId = null;
  popupOverlay.style.display = "none";
}

/* DELETE Note */
async function confirmDelete() {
  if (!deleteId) return;

  await fetch(`${API}/id/${deleteId}`, { method: "DELETE" });

  closePopup();
  loadNotes();
}

/* Back from view page */
function goBack() {
  viewPage.style.display = "none";
  homePage.style.display = "block";
}
</script>

</body>
</html>
